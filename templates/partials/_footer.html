{% load static %}

<!-- ICONOS FLOTANTES DE REDES SOCIALES -->
<!-- Wrapper que contiene la lista y el botón toggle. Hacemos la lista absoluta para que no empuje el botón. -->
<div id="social-wrapper" class="fixed bottom-0 left-0 z-40 flex items-end px-1 pb-1 sm:bottom-6 sm:left-6">
    <div class="relative">
    <!-- Lista de iconos (vertical) - absoluta respecto al contenedor -->
    <!-- Ajustes: bottom offset para no quedar bajo la barra del sistema, max-height y overflow para que haga scroll si es necesario -->
    <div id="social-list" class="absolute left-0 flex flex-col space-y-3 transition-transform transform origin-bottom-right bg-transparent glass-panel p-0 rounded-3xl" style="bottom: 90px; max-height: calc(100vh - 160px); overflow-y: auto;">
        {% if configuracion_sitio and configuracion_sitio.whatsapp_link %}
        <a href="{{ configuracion_sitio.whatsapp_link }}" class="social-icon bg-green-500 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-green-600 transition-all" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
            <i class="fab fa-whatsapp text-3xl"></i>
        </a>
        {% endif %}
        
        {% if configuracion_sitio and configuracion_sitio.facebook_link %}
        <a href="{{ configuracion_sitio.facebook_link }}" class="social-icon bg-blue-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-blue-700 transition-all" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
            <i class="fab fa-facebook-f text-3xl"></i>
        </a>
        {% endif %}

        {% if configuracion_sitio and configuracion_sitio.instagram_link %}
        <a href="{{ configuracion_sitio.instagram_link }}" class="social-icon bg-gradient-to-br from-purple-600 via-pink-600 to-yellow-500 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
            <i class="fab fa-instagram text-3xl"></i>
        </a>
        {% endif %}

        {% if configuracion_sitio and configuracion_sitio.tiktok_link %}
        <a href="{{ configuracion_sitio.tiktok_link }}" class="social-icon bg-black text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center hover:bg-gray-800 transition-all" target="_blank" rel="noopener noreferrer" aria-label="TikTok">
            <i class="fab fa-tiktok text-3xl"></i>
        </a>
        {% endif %}
        </div>
    </div>
    <!-- Botón toggle: ahora fuera del contenedor absoluto y alineado con la base de la lista -->
    <button id="social-toggle" class="ml-2 sm:ml-3 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all will-change-transform fancy-share fancy-share-modern relative overflow-visible" aria-expanded="false" aria-controls="social-list" aria-label="Mostrar redes sociales">
        <span class="icon-wrap relative flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-br from-[--brand-primary] via-[--brand-accent] to-[--brand-secondary] text-white">
            <i class="fas fa-share-nodes text-xl drop-shadow"></i>
        </span>
        <span class="sr-only">Redes</span>
    </button>
</div>
    

<style>
    /* Animación slide + fade para el social-list (duración aumentada) */
    /* Animación más elegante: ligera traslación + escala + fade */
    #social-list {
        transition: transform .38s cubic-bezier(.19,.8,.25,1), opacity .30s ease;
        transform: translateY(8px) scale(.94);
        opacity: 0;
        pointer-events: none;
        will-change: transform, opacity;
    }
    #social-list.show {
        transform: translateY(0) scale(1);
        opacity: 1;
        pointer-events: auto;
    }
    /* Efecto sutil de aparición escalonada */
    #social-list.show a.social-icon { animation: social-pop .45s cubic-bezier(.18,.89,.32,1.28); }
    @keyframes social-pop { 0%{transform:scale(.6);opacity:0} 60%{transform:scale(1.05);opacity:1} 100%{transform:scale(1);} }
    /* Ajuste de posición adicional en móviles para no tapar barra inferior */
    @media (max-width: 639.98px){
        /* Pegar a los bordes usando safe-area para iOS notch */
        #social-wrapper{left:env(safe-area-inset-left,0);bottom:env(safe-area-inset-bottom,0);padding-left:2px;padding-bottom:2px;}
        #social-toggle{width:48px;height:48px;}
    /* La cajita debe medir lo mismo que el botón: 48px totales */
    #social-list{bottom:60px!important; width:48px!important;}
    #social-list.glass-active{padding:4px!important;}
    /* Cada ícono 40x40 + 4px de padding a cada lado = 48px totales */
    #social-list a.social-icon{width:40px;height:40px;}
    #social-list a.social-icon i{font-size:1.1rem;}
    }
    /* Rotación elegante del ícono (+ a X) */
    /* Se elimina rotación + y se incorpora diseño moderno */
    /* Base glass + anillo degradado suave */
    .fancy-share-modern{background:rgba(255,255,255,.08);backdrop-filter:blur(10px) saturate(160%) contrast(110%);-webkit-backdrop-filter:blur(10px) saturate(160%) contrast(110%);}
    .fancy-share-modern:before{content:"";position:absolute;inset:-4px;border-radius:inherit;padding:2px;background:conic-gradient(from 0deg, var(--brand-primary,#ff2d55), var(--brand-accent,#ff5fa3), var(--brand-secondary,#ff2d55) 340deg);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite: xor;mask-composite: exclude;opacity:.55;transition:opacity .5s ease,filter .6s ease;filter:blur(4px);}    
    .fancy-share-modern.open:before{opacity:1;filter:blur(2.2px) brightness(1.15);}
    .fancy-share-modern:after{content:"";position:absolute;inset:0;border-radius:inherit;box-shadow:0 4px 18px -6px rgba(0,0,0,.55),0 2px 8px -2px rgba(0,0,0,.35);} 
    .fancy-share-modern .icon-wrap{box-shadow:0 6px 20px -6px rgba(0,0,0,.55),inset 0 0 0 1px rgba(255,255,255,.25);transition:transform .4s cubic-bezier(.19,.8,.25,1), box-shadow .5s ease;}
    .fancy-share-modern.open .icon-wrap{transform:scale(1.07);box-shadow:0 0 0 3px rgba(255,255,255,.18),0 10px 26px -6px rgba(0,0,0,.65);}
    /* Punto orbital decorativo */
    .fancy-share-modern .icon-wrap:after{content:"";position:absolute;width:8px;height:8px;border-radius:50%;background:linear-gradient(135deg,#fff,#ffe2f1);top:4px;right:6px;box-shadow:0 0 0 2px rgba(255,255,255,.35),0 0 12px 3px rgba(255,120,170,.7);animation:orbit 3.8s linear infinite;transform-origin:-10px 14px;}
    .fancy-share-modern.open .icon-wrap:after{animation-play-state:running;}
    @keyframes orbit{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    /* Pulso sutil al abrir */
    .fancy-share-modern.open .icon-wrap i{animation:icon-pop .55s cubic-bezier(.18,.89,.32,1.28);} 
    @keyframes icon-pop{0%{transform:scale(.6);opacity:.4}55%{transform:scale(1.15);opacity:1}100%{transform:scale(1);} }
    /* Accesible en hover/focus */
    .fancy-share-modern:focus-visible{outline:3px solid rgba(255,255,255,.55);outline-offset:3px;}
    /* Hover tonal */
    .fancy-share-modern:hover:not(.open){background:rgba(255,255,255,.14);}   
    /* Glassmorphism panel (aparece sólo cuando abierto) */
    .glass-panel.glass-active{ 
        background: rgba(255,255,255,0.14); 
        backdrop-filter: blur(14px) saturate(170%) contrast(95%);
        -webkit-backdrop-filter: blur(14px) saturate(170%) contrast(95%);
        border: 1px solid rgba(255,255,255,0.28);
        padding: 14px 14px 18px 14px !important;
        box-shadow: 0 8px 28px -6px rgba(0,0,0,.35), 0 2px 6px -1px rgba(0,0,0,.25);
    }
    .glass-panel.glass-active a.social-icon{box-shadow:0 4px 16px -4px rgba(0,0,0,.4);}
    /* Toggle con anillo multicolor elegante */
    .fancy-share{position:relative;}
    .fancy-share:before{content:"";position:absolute;inset:-3px;z-index:-1;border-radius:inherit;background:conic-gradient(from 0deg,var(--brand-primary,#ff2d55),#ff7abf,#ff2d55 310deg);filter:blur(6px) saturate(140%);opacity:.65;transition:opacity .4s ease;}
    .fancy-share.open:before{opacity:1;}
    .fancy-share:after{content:"";position:absolute;inset:0;border-radius:inherit;background:linear-gradient(135deg,rgba(255,255,255,.35),rgba(255,255,255,.05));mix-blend-mode:overlay;pointer-events:none;}
    .fancy-share.open{box-shadow:0 0 0 4px rgba(255,255,255,.15),0 6px 22px -4px rgba(0,0,0,.55);}
    /* Fallback si no hay soporte backdrop */
    @supports not ((backdrop-filter: blur(10px)) or (-webkit-backdrop-filter: blur(10px))){
        .glass-panel.glass-active{background:rgba(30,30,30,.82);}    
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function(){
    try {
        var socialList = document.getElementById('social-list');
        var toggle = document.getElementById('social-toggle');
        if(!socialList || !toggle) return;

        const isCatalog = document.body.classList.contains('catalog-page');
        const mq = window.matchMedia('(max-width: 639.98px)');

        function applyState(){
            const isMobile = mq.matches;
            if(isCatalog && !isMobile){
                // Catálogo en escritorio: siempre visible, sin toggle
                socialList.classList.add('show');
                toggle.classList.add('hidden');
                socialList.setAttribute('aria-hidden','false');
                toggle.setAttribute('aria-hidden','true');
            } else {
                // Móvil catálogo o cualquier otra página: colapsado inicial con toggle
                socialList.classList.remove('show');
                socialList.setAttribute('aria-hidden','true');
                toggle.classList.remove('hidden');
                toggle.setAttribute('aria-hidden','false');
                toggle.setAttribute('aria-expanded','false');
            }
        }

        applyState();
        mq.addEventListener('change', applyState);

    toggle.addEventListener('click', function(){
            var expanded = this.getAttribute('aria-expanded') === 'true';
            var icon = this.querySelector('i');
            if (expanded) {
                socialList.classList.remove('show');
                socialList.setAttribute('aria-hidden', 'true');
                this.setAttribute('aria-expanded', 'false');
                this.setAttribute('aria-label', 'Mostrar redes sociales');
                this.classList.remove('open');
                socialList.classList.remove('glass-active');
            } else {
                socialList.classList.add('show');
                socialList.setAttribute('aria-hidden', 'false');
                this.setAttribute('aria-expanded', 'true');
                this.setAttribute('aria-label', 'Cerrar redes sociales');
                this.classList.add('open');
                // Activar panel vidrio tras un pequeño frame para animación suave
                requestAnimationFrame(()=>socialList.classList.add('glass-active'));
            }
        }, false);
    } catch(err) {
        console.debug('social toggle init error', err);
    }
});
</script>

<!-- CHATBOT FLOTANTE -->
{% if chatbot_config and chatbot_config.activo %}
<div id="chat-wrapper" class="fixed bottom-6 right-6 z-50">
    <button id="chat-button" class="bg-blue-500 text-white w-16 h-16 rounded-full shadow-lg hover:bg-blue-600 flex items-center justify-center transition-transform transform hover:scale-110">
        <i class="fas fa-comment-dots text-3xl hidden md:inline"></i>
        <span class="md:hidden font-extrabold tracking-wide">CHAT</span>
    </button>
</div>
<!-- === INICIO DE LA MEJORA: Se añade 'flex' por defecto al contenedor === -->
<div id="chat-container" class="fixed bottom-24 right-6 w-80 sm:w-96 h-[500px] bg-white rounded-2xl shadow-xl flex flex-col hidden z-50 border-2 border-pink-200 transition-all">
<!-- === FIN DE LA MEJORA === -->
    <div class="bg-gradient-to-r from-[--brand-primary] to-[--brand-secondary] text-white p-4 rounded-t-xl flex justify-between items-center flex-shrink-0">
        <h3 class="font-bold text-lg">Asistente Virtual</h3>
        <button id="close-chat-button" class="text-white text-2xl" aria-label="Cerrar chat">&times;</button>
    </div>
    <!-- === INICIO DE LA MEJORA: Se añade 'min-h-0' para contener el scroll === -->
    <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 min-h-0">
    <!-- === FIN DE LA MEJORA === -->
        <!-- Los mensajes se añadirán aquí con JavaScript -->
    </div>
    <div class="p-3 border-t flex space-x-2 bg-gray-50 rounded-b-2xl flex-shrink-0">
        <input type="text" id="chat-input" placeholder="Escribe tu mensaje..." class="flex-1 px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-pink-500">
        <button id="chat-send-button" class="bg-[--brand-accent] text-white w-12 h-12 rounded-full font-bold hover:opacity-90 flex items-center justify-center transition-all" aria-label="Enviar mensaje">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>
{% endif %}


<!-- PIE DE PÁGINA -->
<footer class="site-footer bg-gradient-to-r from-[--brand-primary] to-[--brand-secondary] text-white py-5 sm:py-10 mt-4 sm:mt-16">
    <div class="container mx-auto px-3 sm:px-6 text-center">
        {% if configuracion_sitio.logo %}
            <img src="{{ configuracion_sitio.logo.url }}" alt="Logo de {{ configuracion_sitio.nombre_tienda }}" class="footer-logo h-10 sm:h-16 w-auto mx-auto mb-1 sm:mb-4 drop-shadow-lg">
        {% else %}
            <img src="{% static 'productos/logo.png' %}" alt="Logo Fantasía Íntima" class="footer-logo h-10 sm:h-16 w-auto mx-auto mb-1 sm:mb-4 drop-shadow-lg" onerror="this.onerror=null;this.src='https://placehold.co/100x64/f9a8d4/ffffff?text=Logo';">
        {% endif %}
        
    <div class="footer-links flex justify-center flex-wrap gap-x-3 sm:gap-x-6 gap-y-1.5 my-2 sm:my-4 text-xs sm:text-base">
            {% for pagina in paginas_informativas %}
                <a href="{% url 'pagina_informativa' pagina.slug %}" class="text-gray-200 hover:text-white transition-colors hover:underline">{{ pagina.titulo }}</a>
            {% endfor %}
        </div>
        
    <p class="text-[11px] sm:text-base leading-tight">&copy; {% now "Y" %} {{ configuracion_sitio.nombre_tienda|default:"Fantasía Íntima" }}. Todos los derechos reservados.</p>
    </div>
</footer>