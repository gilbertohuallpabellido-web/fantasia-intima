<!-- templates/admin/base_site.html -->

{% extends "admin/base.html" %}
{% load static %}

{# =================================================================== #}
{# === INICIO: Anulación de bloques para personalizar el admin === #}
{# =================================================================== #}

{# Anulamos el título del sitio #}
{% block title %}{% if site_title %}{{ site_title }}{% else %}Fantasía Íntima Admin{% endif %}{% endblock %}

{# Anulamos la cabecera para poner nuestro logo y nombre #}
{% block branding %}
<h1 id="site-name">
    <a href="{% url 'admin:index' %}" style="display: flex; align-items: center; text-decoration: none;">
        <img src="{% static 'productos/logo.png' %}" alt="Logo Fantasía Íntima" style="height: 35px; width: auto; margin-right: 10px;">
        <span style="font-weight: bold; font-size: 1.2rem;">Fantasía Íntima</span>
    </a>
</h1>
<!-- Compact mode toggle -->
<button id="compact-toggle" title="Activar modo compacto" style="position: absolute; right: 1rem; top: 0.75rem; background: transparent; border: 2px solid rgba(255,255,255,0.18); color: white; padding: 6px 10px; border-radius: 9999px; cursor: pointer; font-weight:600">Compacto</button>
{% endblock %}

{# Anulamos los estilos para añadir los nuestros #}
{% block extrastyle %}
    {{ block.super }}
    <!-- 
      Aquí cargamos nuestra hoja de estilos personalizada.
      Esto aplicará nuestros colores sobre el admin por defecto.
    -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/admin_custom.css' %}">
{% endblock %}

    {% block extrahead %}
    {{ block.super }}
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <script>
    document.addEventListener('DOMContentLoaded', function(){
        var btn = document.getElementById('compact-toggle');
        if(!btn) return;
        var body = document.body;
        // Inicializar desde localStorage
        var compact = localStorage.getItem('admin_compact_mode') === '1';
        if(compact) body.classList.add('admin-compact');
        function updateButton(){
            btn.textContent = body.classList.contains('admin-compact') ? 'Compacto ✓' : 'Compacto';
        }
        updateButton();
        btn.addEventListener('click', function(){
            body.classList.toggle('admin-compact');
            var enabled = body.classList.contains('admin-compact');
            localStorage.setItem('admin_compact_mode', enabled ? '1' : '0');
            updateButton();
        });
        
        // Refuerzo: asegurar scroll horizontal en inlines tabulares
        try {
            var inlineTables = document.querySelectorAll('.tabular.inline-related table, .tabular-inline table, .inline-group > table, .inline-related > table');
            inlineTables.forEach(function(tbl){
                // Estilos directos por si algún CSS externo los anula
                tbl.style.display = 'block';
                tbl.style.overflowX = 'auto';
                tbl.style.webkitOverflowScrolling = 'touch';
                tbl.style.tableLayout = 'auto';
                if (!tbl.style.minWidth) tbl.style.minWidth = '720px';
                var parent = tbl.closest('fieldset.module') || tbl.parentElement;
                if (parent) {
                    parent.style.overflowX = 'auto';
                    parent.style.webkitOverflowScrolling = 'touch';
                }
            });
        } catch(e) { /* no-op */ }
    });
    </script>
    {% endblock %}

{# =================================================================== #}
{# === FIN: Anulación de bloques === #}
{# =================================================================== #}